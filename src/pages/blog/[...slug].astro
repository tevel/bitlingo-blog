---
import { DEFAULT_LANG } from '../../consts';
import { getCollection } from 'astro:content';
export const prerender = true;

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	const getPathSlug = (post: (typeof posts)[number]) => {
		if (post.data.path) return post.data.path;
		if (post.data.slug?.startsWith(`${post.data.lang}-`)) {
			return post.data.slug.slice(post.data.lang.length + 1);
		}
		return post.data.slug ?? post.slug ?? post.id;
	};
	return posts.map((post) => ({
		params: { slug: getPathSlug(post) },
	}));
}

const { slug } = Astro.params;
const target = `/blog/${DEFAULT_LANG}/${slug}/`;
---

<!doctype html>
<html lang="en">
	<head>
		<meta http-equiv="refresh" content={`0; url=${target}`} />
		<link rel="canonical" href={target} />
	</head>
	<body>
		<p>Redirecting to <a href={target}>{target}</a>...</p>
	</body>
</html>
