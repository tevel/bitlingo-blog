---
/**
 * Interactive Flashcard Component
 * Flip cards to reveal translation with smooth animations
 */
import { LANGUAGE_DATA, UI_TRANSLATIONS } from '../../data/vocabulary';

interface Props {
  lang?: string;
  targetLang?: string;
  cardCount?: number;
}

const { lang = 'en', targetLang = 'fr', cardCount = 5 } = Astro.props;

const uiStrings = UI_TRANSLATIONS[lang] || UI_TRANSLATIONS.en;
const targetData = LANGUAGE_DATA[targetLang] || LANGUAGE_DATA.fr;
const words = targetData.words.slice(0, cardCount);
---

<div class="flashcard-deck" data-lang={lang} data-target-lang={targetLang}>
  <div class="deck-header">
    <div class="deck-title">
      <span class="deck-icon">ðŸŽ´</span>
      <h3>Flashcards</h3>
    </div>
    <div class="language-badge">
      <span class="flag">{targetData.flag}</span>
      <span class="lang-name">{targetData.nativeName}</span>
    </div>
  </div>

  <div class="card-container">
    <div class="flashcard" data-flipped="false">
      <div class="card-inner">
        <div class="card-front">
          <div class="card-label">{uiStrings.flashcard_front}</div>
          <div class="card-word"></div>
          <div class="card-pronunciation"></div>
          <div class="flip-hint">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 1l4 4-4 4"/>
              <path d="M3 11V9a4 4 0 0 1 4-4h14"/>
              <path d="M7 23l-4-4 4-4"/>
              <path d="M21 13v2a4 4 0 0 1-4 4H3"/>
            </svg>
            <span>{uiStrings.flashcard_flip}</span>
          </div>
        </div>
        <div class="card-back">
          <div class="card-label">{uiStrings.flashcard_back}</div>
          <div class="card-translation"></div>
          <div class="card-category"></div>
          <div class="flip-hint">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 1l4 4-4 4"/>
              <path d="M3 11V9a4 4 0 0 1 4-4h14"/>
              <path d="M7 23l-4-4 4-4"/>
              <path d="M21 13v2a4 4 0 0 1-4 4H3"/>
            </svg>
            <span>{uiStrings.flashcard_flip}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="deck-controls">
    <button class="btn-prev" disabled>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
      <span>{uiStrings.flashcard_prev}</span>
    </button>
    
    <div class="card-counter">
      <span class="current-card">1</span> / <span class="total-cards">{cardCount}</span>
    </div>
    
    <button class="btn-next">
      <span>{uiStrings.flashcard_next}</span>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 18l6-6-6-6"/>
      </svg>
    </button>
  </div>

  <div class="progress-dots">
    {words.map((_, i) => (
      <button class={`dot ${i === 0 ? 'active' : ''}`} data-index={i}></button>
    ))}
  </div>

  <div class="flashcard-share">
    <span class="share-label">Share this game:</span>
    <div class="share-buttons-inline">
      <a class="share-btn-small twitter-share" target="_blank" rel="noopener noreferrer" aria-label="Share on Twitter" title="Share on Twitter">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
      </a>
      <a class="share-btn-small facebook-share" target="_blank" rel="noopener noreferrer" aria-label="Share on Facebook" title="Share on Facebook">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
      </a>
      <a class="share-btn-small whatsapp-share" target="_blank" rel="noopener noreferrer" aria-label="Share on WhatsApp" title="Share on WhatsApp">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
      </a>
      <button class="share-btn-small copy-link" aria-label="Copy link" title="Copy link">
        <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
        <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;"><polyline points="20 6 9 17 4 12"/></svg>
      </button>
    </div>
  </div>
</div>

<script define:vars={{ words }}>
  document.addEventListener('DOMContentLoaded', () => {
    const decks = document.querySelectorAll('.flashcard-deck');
    
    decks.forEach(deck => {
      let currentIndex = 0;
      
      const elements = {
        flashcard: deck.querySelector('.flashcard'),
        cardWord: deck.querySelector('.card-word'),
        cardPronunciation: deck.querySelector('.card-pronunciation'),
        cardTranslation: deck.querySelector('.card-translation'),
        cardCategory: deck.querySelector('.card-category'),
        currentCard: deck.querySelector('.current-card'),
        btnPrev: deck.querySelector('.btn-prev'),
        btnNext: deck.querySelector('.btn-next'),
        dots: deck.querySelectorAll('.dot'),
      };

      function updateCard(index) {
        const word = words[index];
        elements.cardWord.textContent = word.word;
        elements.cardPronunciation.textContent = word.pronunciation || '';
        elements.cardTranslation.textContent = word.translation;
        elements.cardCategory.textContent = word.category;
        elements.currentCard.textContent = index + 1;
        
        // Reset flip state
        elements.flashcard.dataset.flipped = 'false';
        
        // Update buttons
        elements.btnPrev.disabled = index === 0;
        elements.btnNext.disabled = index === words.length - 1;
        
        // Update dots
        elements.dots.forEach((dot, i) => {
          dot.classList.toggle('active', i === index);
        });
      }

      function flipCard() {
        const isFlipped = elements.flashcard.dataset.flipped === 'true';
        elements.flashcard.dataset.flipped = (!isFlipped).toString();
      }

      function prevCard() {
        if (currentIndex > 0) {
          currentIndex--;
          updateCard(currentIndex);
        }
      }

      function nextCard() {
        if (currentIndex < words.length - 1) {
          currentIndex++;
          updateCard(currentIndex);
        }
      }

      // Event listeners
      elements.flashcard.addEventListener('click', flipCard);
      elements.btnPrev.addEventListener('click', prevCard);
      elements.btnNext.addEventListener('click', nextCard);
      
      elements.dots.forEach(dot => {
        dot.addEventListener('click', () => {
          currentIndex = parseInt(dot.dataset.index);
          updateCard(currentIndex);
        });
      });

      // Keyboard navigation
      deck.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') prevCard();
        if (e.key === 'ArrowRight') nextCard();
        if (e.key === ' ' || e.key === 'Enter') {
          e.preventDefault();
          flipCard();
        }
      });

      // Initialize
      updateCard(0);

      // Setup share buttons
      const shareText = `Practice vocabulary with BitLingo flashcards! ðŸŽ´ Try it yourself:`;
      const shareUrl = window.location.href;
      
      const twitterShare = deck.querySelector('.twitter-share');
      const facebookShare = deck.querySelector('.facebook-share');
      const whatsappShare = deck.querySelector('.whatsapp-share');
      const copyBtn = deck.querySelector('.copy-link');
      
      if (twitterShare) twitterShare.href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(shareUrl)}`;
      if (facebookShare) facebookShare.href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
      if (whatsappShare) whatsappShare.href = `https://wa.me/?text=${encodeURIComponent(shareText + ' ' + shareUrl)}`;
      if (copyBtn) {
        copyBtn.addEventListener('click', async () => {
          try {
            await navigator.clipboard.writeText(`${shareText} ${shareUrl}`);
            const copyIcon = copyBtn.querySelector('.copy-icon');
            const checkIcon = copyBtn.querySelector('.check-icon');
            if (copyIcon && checkIcon) {
              copyIcon.style.display = 'none';
              checkIcon.style.display = 'block';
              copyBtn.classList.add('copied');
              setTimeout(() => {
                copyIcon.style.display = 'block';
                checkIcon.style.display = 'none';
                copyBtn.classList.remove('copied');
              }, 2000);
            }
          } catch (err) {
            console.error('Failed to copy:', err);
          }
        });
      }
    });
  });
</script>

<style>
  .flashcard-deck {
    background: linear-gradient(145deg, rgba(26, 54, 93, 0.9), rgba(17, 34, 61, 0.95));
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 1.5rem;
    max-width: 450px;
    margin: 2rem auto;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 60px rgba(74, 144, 226, 0.1);
  }

  .deck-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .deck-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .deck-icon {
    font-size: 1.5rem;
  }

  .deck-title h3 {
    margin: 0;
    font-size: 1.25rem;
    background: linear-gradient(135deg, #4a90e2, #1a365d);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .language-badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(255, 255, 255, 0.1);
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.9rem;
  }

  .flag {
    font-size: 1.2rem;
  }

  .lang-name {
    color: rgba(255, 255, 255, 0.8);
  }

  .card-container {
    perspective: 1000px;
    margin-bottom: 1.5rem;
  }

  .flashcard {
    cursor: pointer;
    height: 280px;
    position: relative;
  }

  .card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    transform-style: preserve-3d;
  }

  .flashcard[data-flipped="true"] .card-inner {
    transform: rotateY(180deg);
  }

  .card-front, .card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    box-sizing: border-box;
  }

  .card-front {
    background: linear-gradient(145deg, rgba(245, 166, 35, 0.2), rgba(224, 154, 0, 0.1));
    border: 1px solid rgba(245, 166, 35, 0.3);
  }

  .card-back {
    background: linear-gradient(145deg, rgba(74, 144, 226, 0.2), rgba(26, 54, 93, 0.3));
    border: 1px solid rgba(74, 144, 226, 0.3);
    transform: rotateY(180deg);
  }

  .card-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: rgba(255, 255, 255, 0.5);
    margin-bottom: 1rem;
  }

  .card-word {
    font-size: 2.5rem;
    font-weight: 700;
    color: white;
    text-align: center;
    margin-bottom: 0.5rem;
  }

  .card-pronunciation {
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.6);
    font-style: italic;
  }

  .card-translation {
    font-size: 2rem;
    font-weight: 600;
    color: white;
    text-align: center;
    margin-bottom: 0.5rem;
  }

  .card-category {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.5);
    text-transform: capitalize;
    background: rgba(255, 255, 255, 0.1);
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
  }

  .flip-hint {
    position: absolute;
    bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    color: rgba(255, 255, 255, 0.4);
    font-size: 0.8rem;
  }

  .flip-hint svg {
    width: 16px;
    height: 16px;
  }

  .deck-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .btn-prev, .btn-next {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 10px;
    padding: 0.6rem 1rem;
    color: white;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .btn-prev:hover:not(:disabled), .btn-next:hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(245, 166, 35, 0.5);
  }

  .btn-prev:disabled, .btn-next:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  .btn-prev svg, .btn-next svg {
    width: 18px;
    height: 18px;
  }

  .card-counter {
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.6);
  }

  .current-card {
    color: #f5a623;
    font-weight: 600;
  }

  .progress-dots {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
  }

  .dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 0;
  }

  .dot:hover {
    background: rgba(255, 255, 255, 0.4);
  }

  .dot.active {
    background: linear-gradient(135deg, #f5a623, #e09a00);
    transform: scale(1.2);
  }

  .flashcard-share {
    margin-top: 1.5rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    text-align: center;
  }

  .flashcard-share .share-label {
    display: block;
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.6);
    margin-bottom: 0.75rem;
  }

  .share-buttons-inline {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
  }

  .share-btn-small {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
  }

  .share-btn-small:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
  }

  .share-btn-small svg { 
    width: 18px; 
    height: 18px; 
  }

  .share-btn-small.twitter-share:hover { 
    background: rgba(29, 161, 242, 0.2); 
    color: #1da1f2; 
  }

  .share-btn-small.facebook-share:hover { 
    background: rgba(24, 119, 242, 0.2); 
    color: #1877f2; 
  }

  .share-btn-small.whatsapp-share:hover { 
    background: rgba(37, 211, 102, 0.2); 
    color: #25d366; 
  }

  .share-btn-small.copy-link:hover { 
    background: rgba(245, 166, 35, 0.2); 
    color: #f5a623; 
  }

  .share-btn-small.copied { 
    background: rgba(34, 197, 94, 0.2); 
    color: #22c55e; 
  }

  @media (max-width: 480px) {
    .flashcard-deck {
      padding: 1rem;
      margin: 1rem;
    }

    .flashcard {
      height: 240px;
    }

    .card-word {
      font-size: 2rem;
    }

    .card-translation {
      font-size: 1.5rem;
    }

    .btn-prev span, .btn-next span {
      display: none;
    }
  }
</style>
