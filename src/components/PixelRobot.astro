---
/**
 * Bit the Robot - BitLingo's friendly mascot companion!
 * A CSS-based animated robot that reacts to user actions and provides encouragement.
 * Now with 200+ phrases in 16 languages, 18 idle activities, and sound effects!
 */
import { phrases, type SupportedLang } from '../data/pixelPhrases';

interface Props {
  initialMood?: 'idle' | 'happy' | 'excited' | 'celebrating' | 'thinking' | 'sleeping' | 'encouraging' | 'proud' | 'wave';
  showOnLoad?: boolean;
  position?: 'bottom-right' | 'bottom-left' | 'inline';
  lang?: SupportedLang;
}

const { initialMood = 'wave', showOnLoad = true, position = 'bottom-right', lang } = Astro.props;

// Detect language from URL if not provided
function detectLang(): SupportedLang {
  if (lang) return lang;
  const url = Astro.url.pathname;
  const langMatch = url.match(/\/blog\/([a-z]{2})\//);
  if (langMatch && langMatch[1] in phrases) {
    return langMatch[1] as SupportedLang;
  }
  return 'en';
}

const currentLang = detectLang();
const currentPhrases = phrases[currentLang];
---

<div 
  class={`bit-container ${position}`} 
  data-initial-mood={initialMood}
  data-show-on-load={showOnLoad}
  data-lang={currentLang}
  data-phrases={JSON.stringify(currentPhrases)}
  id="bit-robot-container"
>
  <!-- Speech Bubble -->
  <div class="speech-bubble" id="bit-speech" hidden>
    <span class="speech-text" id="bit-speech-text"></span>
    <div class="speech-tail"></div>
  </div>

  <!-- The Robot -->
  <div class="bit-robot" id="bit-robot" data-mood={initialMood}>
    <!-- Antenna -->
    <div class="antenna">
      <div class="antenna-stem"></div>
      <div class="antenna-ball" id="antenna-led"></div>
    </div>

    <!-- Head with Headphones -->
    <div class="robot-head">
      <!-- Left Headphone -->
      <div class="headphone headphone-left">
        <div class="headphone-cup"></div>
      </div>

      <!-- Face Screen -->
      <div class="face-screen">
        <!-- Eyes -->
        <div class="eyes">
          <div class="eye eye-left" id="eye-left">
            <div class="pupil"></div>
          </div>
          <div class="eye eye-right" id="eye-right">
            <div class="pupil"></div>
          </div>
        </div>
        <!-- Mouth -->
        <div class="mouth" id="bit-mouth"></div>
      </div>

      <!-- Right Headphone -->
      <div class="headphone headphone-right">
        <div class="headphone-cup"></div>
      </div>
    </div>

    <!-- Body -->
    <div class="robot-body">
      <div class="body-screen">
        <span class="heart-icon">‚ù§Ô∏è</span>
      </div>
      <div class="body-buttons">
        <div class="body-button"></div>
        <div class="body-button"></div>
      </div>
    </div>

    <!-- Arms -->
    <div class="robot-arm arm-left" id="arm-left">
      <div class="arm-segment"></div>
      <div class="arm-hand">‚úã</div>
    </div>
    <div class="robot-arm arm-right" id="arm-right">
      <div class="arm-segment"></div>
      <div class="arm-hand">üëã</div>
    </div>

    <!-- Legs -->
    <div class="robot-legs">
      <div class="leg leg-left" id="leg-left"></div>
      <div class="leg leg-right" id="leg-right"></div>
    </div>
  </div>

  <!-- Celebration Particles -->
  <div class="celebration-particles" id="bit-particles" hidden>
    <span>‚ú®</span><span>üéâ</span><span>‚≠ê</span><span>üåü</span><span>üí´</span>
  </div>
</div>

<script>
  // ============================================
  // BIT THE ROBOT - SOUND EFFECTS
  // ============================================
  class BitSounds {
    constructor() {
      this.enabled = localStorage.getItem('bitlingo_sounds') !== 'false';
      this.audioContext = null;
    }

    getContext() {
      if (!this.audioContext) {
        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      return this.audioContext;
    }

    playTone(frequency, duration, type = 'sine', volume = 0.15) {
      if (!this.enabled) return;
      try {
        const ctx = this.getContext();
        const oscillator = ctx.createOscillator();
        const gainNode = ctx.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(ctx.destination);
        
        oscillator.type = type;
        oscillator.frequency.setValueAtTime(frequency, ctx.currentTime);
        
        gainNode.gain.setValueAtTime(0, ctx.currentTime);
        gainNode.gain.linearRampToValueAtTime(volume, ctx.currentTime + 0.01);
        gainNode.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
        
        oscillator.start(ctx.currentTime);
        oscillator.stop(ctx.currentTime + duration);
      } catch (e) {
        console.log('Audio not available');
      }
    }

    playGreeting() {
      const notes = [
        { freq: 523, delay: 0, duration: 0.1 },     // C5
        { freq: 659, delay: 0.12, duration: 0.1 },  // E5
        { freq: 784, delay: 0.24, duration: 0.15 }, // G5
      ];
      notes.forEach(n => {
        setTimeout(() => this.playTone(n.freq, n.duration, 'sine', 0.15), n.delay * 1000);
      });
    }

    playCelebration() {
      const notes = [
        { freq: 523, delay: 0, duration: 0.08 },
        { freq: 659, delay: 0.08, duration: 0.08 },
        { freq: 784, delay: 0.16, duration: 0.08 },
        { freq: 1047, delay: 0.24, duration: 0.2 },
        { freq: 784, delay: 0.35, duration: 0.08 },
        { freq: 1047, delay: 0.43, duration: 0.25 },
      ];
      notes.forEach(n => {
        setTimeout(() => this.playTone(n.freq, n.duration, 'square', 0.1), n.delay * 1000);
      });
    }

    playEncouragement() {
      const notes = [
        { freq: 440, delay: 0, duration: 0.12 },    // A4
        { freq: 523, delay: 0.12, duration: 0.12 }, // C5
        { freq: 659, delay: 0.24, duration: 0.15 }, // E5
      ];
      notes.forEach(n => {
        setTimeout(() => this.playTone(n.freq, n.duration, 'sine', 0.12), n.delay * 1000);
      });
    }

    playTip() {
      const notes = [
        { freq: 392, delay: 0, duration: 0.1 },    // G4
        { freq: 440, delay: 0.12, duration: 0.1 }, // A4
        { freq: 494, delay: 0.24, duration: 0.12 }, // B4
      ];
      notes.forEach(n => {
        setTimeout(() => this.playTone(n.freq, n.duration, 'triangle', 0.1), n.delay * 1000);
      });
    }

    playJoke() {
      const notes = [
        { freq: 600, delay: 0, duration: 0.06 },
        { freq: 800, delay: 0.08, duration: 0.06 },
        { freq: 500, delay: 0.16, duration: 0.08 },
        { freq: 900, delay: 0.26, duration: 0.1 },
        { freq: 400, delay: 0.38, duration: 0.12 },
      ];
      notes.forEach(n => {
        setTimeout(() => this.playTone(n.freq, n.duration, 'square', 0.1), n.delay * 1000);
      });
    }

    playQuiz() {
      const notes = [
        { freq: 523, delay: 0, duration: 0.08 },
        { freq: 659, delay: 0.1, duration: 0.08 },
        { freq: 523, delay: 0.2, duration: 0.1 },
      ];
      notes.forEach(n => {
        setTimeout(() => this.playTone(n.freq, n.duration, 'triangle', 0.12), n.delay * 1000);
      });
    }

    playThinking() {
      const notes = [
        { freq: 350, delay: 0, duration: 0.15 },
        { freq: 380, delay: 0.2, duration: 0.15 },
        { freq: 350, delay: 0.4, duration: 0.2 },
      ];
      notes.forEach(n => {
        setTimeout(() => this.playTone(n.freq, n.duration, 'sine', 0.08), n.delay * 1000);
      });
    }

    playExcited() {
      const notes = [
        { freq: 800, delay: 0, duration: 0.05 },
        { freq: 1000, delay: 0.06, duration: 0.05 },
        { freq: 1200, delay: 0.12, duration: 0.05 },
        { freq: 1000, delay: 0.18, duration: 0.05 },
        { freq: 1200, delay: 0.24, duration: 0.08 },
      ];
      notes.forEach(n => {
        setTimeout(() => this.playTone(n.freq, n.duration, 'square', 0.1), n.delay * 1000);
      });
    }

    playBeep() {
      this.playTone(600, 0.08, 'square', 0.1);
      setTimeout(() => this.playTone(800, 0.1, 'square', 0.08), 100);
    }

    playForCategory(category) {
      const categoryMap = {
        greeting: () => this.playGreeting(),
        introduction: () => this.playGreeting(),
        encourage: () => this.playEncouragement(),
        motivate: () => this.playEncouragement(),
        celebrate: () => this.playCelebration(),
        feature: () => this.playTip(),
        tip: () => this.playTip(),
        fact: () => this.playTip(),
        quiz: () => this.playQuiz(),
        idle: () => this.playThinking(),
        prompt: () => this.playBeep(),
      };
      const playFn = categoryMap[category];
      if (playFn) playFn();
    }
  }

  // ============================================
  // BIT THE ROBOT - MAIN CLASS
  // ============================================
  class BitRobot {
    constructor(containerId) {
      this.container = document.getElementById(containerId);
      this.robot = document.getElementById('bit-robot');
      this.speech = document.getElementById('bit-speech');
      this.speechText = document.getElementById('bit-speech-text');
      this.particles = document.getElementById('bit-particles');
      this.armLeft = document.getElementById('arm-left');
      this.armRight = document.getElementById('arm-right');
      this.eyeLeft = document.getElementById('eye-left');
      this.eyeRight = document.getElementById('eye-right');
      this.mouth = document.getElementById('bit-mouth');
      this.antennaLed = document.getElementById('antenna-led');
      this.legLeft = document.getElementById('leg-left');
      this.legRight = document.getElementById('leg-right');

      // Parse phrases from data attribute
      this.phrases = JSON.parse(this.container.dataset.phrases || '{}');
      this.lang = this.container.dataset.lang || 'en';

      // Sound effects
      this.sounds = new BitSounds();

      // Idle activities list
      this.IDLE_ACTIVITIES = [
        'jumping', 'learning', 'reading', 'swimming', 'sleeping', 'dancing',
        'spinning', 'waving', 'dizzy', 'yoga', 'sneeze', 'looking',
        'bored', 'excited', 'stretching', 'headbang', 'pushups', 'karate'
      ];

      this.state = {
        mood: this.container.dataset.initialMood || 'idle',
        isAwake: true,
        sleepTimer: null,
        messageTimer: null,
        moodResetTimer: null,
        idleTimer: null,
        activityTimer: null,
        currentActivity: null,
        showingMessage: false,
        phraseHistory: new Set(),
        introShown: false
      };

      this.init();
    }

    init() {
      // Click interaction
      this.robot.addEventListener('click', () => this.handleClick());
      
      // Reset sleep timer on any page interaction
      document.addEventListener('mousemove', () => this.resetSleepTimer());
      document.addEventListener('keydown', () => this.resetSleepTimer());
      document.addEventListener('scroll', () => this.resetSleepTimer());
      document.addEventListener('touchstart', () => this.resetSleepTimer());

      // Listen for game events
      window.addEventListener('game:complete', (e) => this.handleGameComplete(e));
      window.addEventListener('achievement:unlocked', (e) => this.handleAchievement(e));
      window.addEventListener('xp:gained', (e) => this.handleXpGain(e));
      window.addEventListener('level:up', (e) => this.handleLevelUp(e));

      // Initial greeting
      if (this.container.dataset.showOnLoad === 'true') {
        setTimeout(() => {
          // First time, show introduction
          if (!localStorage.getItem('bit_introduced')) {
            this.setMood('wave');
            const introPhrase = this.getUniqueRandomPhrase('introduction');
            this.showMessage(introPhrase, 'introduction');
            localStorage.setItem('bit_introduced', 'true');
          } else {
            this.setMood('wave');
            this.showMessage(this.getTimeBasedGreeting(), 'greeting');
          }
          this.resetSleepTimer();
          this.scheduleIdleActivity();
        }, 500);
      }
    }

    getTimeBasedGreeting() {
      const hour = new Date().getHours();
      const greetings = this.phrases.greeting || [];
      
      // Morning (5-11) - first 3 greetings
      if (hour >= 5 && hour < 12) {
        return greetings.slice(0, 3)[Math.floor(Math.random() * 3)] || greetings[0] || "Hello! üëã";
      }
      // Afternoon (12-17) - next 3 greetings
      if (hour >= 12 && hour < 18) {
        return greetings.slice(3, 6)[Math.floor(Math.random() * 3)] || greetings[0] || "Hello! üëã";
      }
      // Evening (18-22) - next 3 greetings
      if (hour >= 18 && hour < 23) {
        return greetings.slice(6, 9)[Math.floor(Math.random() * 3)] || greetings[0] || "Hello! üëã";
      }
      // Night (23-4) - remaining greetings
      return greetings.slice(9, 12)[Math.floor(Math.random() * 3)] || greetings[0] || "Hello! üëã";
    }

    getUniqueRandomPhrase(category) {
      const phrases = this.phrases[category] || [];
      if (phrases.length === 0) return "Hi! I'm Bit! ü§ñ";
      
      // Filter out recently used phrases
      const available = phrases.filter(p => !this.state.phraseHistory.has(p));
      
      // If all phrases used, reset history
      if (available.length === 0) {
        this.state.phraseHistory.clear();
        return phrases[Math.floor(Math.random() * phrases.length)];
      }
      
      const phrase = available[Math.floor(Math.random() * available.length)];
      this.state.phraseHistory.add(phrase);
      
      // Keep history manageable (last 20 phrases)
      if (this.state.phraseHistory.size > 20) {
        const arr = Array.from(this.state.phraseHistory);
        this.state.phraseHistory = new Set(arr.slice(-20));
      }
      
      return phrase;
    }

    getRandomMessage(mood) {
      // Map moods to phrase categories
      const moodToCategory = {
        happy: 'encourage',
        excited: 'celebrate',
        celebrating: 'celebrate',
        encouraging: 'motivate',
        proud: 'encourage',
        sleeping: 'idle',
        idle: 'prompt',
        thinking: 'fact',
        wave: 'greeting'
      };
      
      const category = moodToCategory[mood] || 'prompt';
      return this.getUniqueRandomPhrase(category);
    }

    setMood(mood) {
      // Clear any current activity
      this.clearActivity();
      
      this.state.mood = mood;
      this.robot.dataset.mood = mood;
      this.state.isAwake = mood !== 'sleeping';
      
      // Clear any existing mood reset timer
      if (this.state.moodResetTimer) {
        clearTimeout(this.state.moodResetTimer);
      }

      // Auto-return excited/celebrating states to happy after 3 seconds
      if (['excited', 'celebrating'].includes(mood)) {
        this.state.moodResetTimer = setTimeout(() => {
          this.setMood('happy');
          this.scheduleIdleActivity();
        }, 3000);
      }
    }

    showMessage(message, category = 'prompt', duration = 4000) {
      // Clear any existing message timer
      if (this.state.messageTimer) {
        clearTimeout(this.state.messageTimer);
      }

      // Clear any activity while showing message
      this.clearActivity();
      this.state.showingMessage = true;

      // Play sound for category
      this.sounds.playForCategory(category);

      this.speechText.textContent = message;
      this.speech.removeAttribute('hidden');
      this.speech.classList.add('visible');

      this.state.messageTimer = setTimeout(() => {
        this.speech.classList.remove('visible');
        this.state.showingMessage = false;
        setTimeout(() => {
          this.speech.setAttribute('hidden', '');
          this.scheduleIdleActivity();
        }, 300);
      }, duration);
    }

    showParticles() {
      this.particles.removeAttribute('hidden');
      this.particles.classList.add('active');
      
      setTimeout(() => {
        this.particles.classList.remove('active');
        this.particles.setAttribute('hidden', '');
      }, 1500);
    }

    // ============================================
    // IDLE ACTIVITIES
    // ============================================
    scheduleIdleActivity() {
      if (this.state.idleTimer) {
        clearTimeout(this.state.idleTimer);
      }

      this.state.idleTimer = setTimeout(() => {
        // Only start activity if not busy
        if (!this.state.showingMessage && 
            this.state.mood !== 'celebrating' && 
            this.state.mood !== 'sleeping' &&
            this.state.isAwake) {
          this.startIdleActivity();
        } else {
          this.scheduleIdleActivity();
        }
      }, 3000 + Math.random() * 2000);
    }

    startIdleActivity() {
      const activity = this.IDLE_ACTIVITIES[Math.floor(Math.random() * this.IDLE_ACTIVITIES.length)];
      this.state.currentActivity = activity;
      
      // Apply activity class
      this.robot.classList.add(`activity-${activity}`);
      
      // Clear activity after 3-5 seconds
      this.state.activityTimer = setTimeout(() => {
        this.clearActivity();
        this.scheduleIdleActivity();
      }, 3000 + Math.random() * 2000);
    }

    clearActivity() {
      if (this.state.currentActivity) {
        this.robot.classList.remove(`activity-${this.state.currentActivity}`);
        this.state.currentActivity = null;
      }
      if (this.state.activityTimer) {
        clearTimeout(this.state.activityTimer);
      }
    }

    // ============================================
    // MEGA CELEBRATION DANCE
    // ============================================
    startMegaDance() {
      this.robot.classList.add('mega-dance');
      this.sounds.playCelebration();
      
      setTimeout(() => {
        this.robot.classList.remove('mega-dance');
        this.setMood('happy');
        this.scheduleIdleActivity();
      }, 4000);
    }

    // ============================================
    // EVENT HANDLERS
    // ============================================
    handleClick() {
      this.sounds.playBeep();
      
      if (!this.state.isAwake) {
        // Wake up!
        this.setMood('happy');
        this.showMessage(this.getUniqueRandomPhrase('greeting'), 'greeting');
        return;
      }

      // Randomly show introduction sometimes
      if (Math.random() < 0.15) {
        this.setMood('wave');
        this.showMessage(this.getUniqueRandomPhrase('introduction'), 'introduction');
        return;
      }

      // Random interaction - each click shows a new random phrase from different categories
      const interactions = [
        () => {
          this.setMood('happy');
          this.showMessage(this.getUniqueRandomPhrase('encourage'), 'encourage');
        },
        () => {
          this.setMood('excited');
          this.showMessage(this.getUniqueRandomPhrase('motivate'), 'motivate');
        },
        () => {
          this.setMood('thinking');
          this.showMessage(this.getUniqueRandomPhrase('fact'), 'fact', 5000);
        },
        () => {
          this.setMood('thinking');
          this.showMessage(this.getUniqueRandomPhrase('tip'), 'tip', 5000);
        },
        () => {
          this.setMood('proud');
          this.showMessage(this.getUniqueRandomPhrase('feature'), 'feature', 5000);
        },
        () => {
          this.setMood('excited');
          this.showMessage(this.getUniqueRandomPhrase('quiz'), 'quiz', 5000);
        },
        () => {
          this.setMood('wave');
          this.showMessage(this.getUniqueRandomPhrase('prompt'), 'prompt');
        },
        () => {
          this.setMood('happy');
          this.showMessage(this.getUniqueRandomPhrase('idle'), 'idle');
        }
      ];

      const randomInteraction = interactions[Math.floor(Math.random() * interactions.length)];
      randomInteraction();
      this.resetSleepTimer();
    }

    handleGameComplete(event) {
      const { game, score, total } = event.detail;
      const percentage = total ? (score / total) * 100 : 100;

      if (percentage === 100) {
        this.setMood('celebrating');
        this.showMessage(this.getUniqueRandomPhrase('celebrate'), 'celebrate');
        this.showParticles();
        this.startMegaDance();
      } else if (percentage >= 80) {
        this.setMood('excited');
        this.sounds.playExcited();
        this.showMessage(this.getUniqueRandomPhrase('celebrate'), 'celebrate');
      } else if (percentage >= 50) {
        this.setMood('happy');
        this.showMessage(this.getUniqueRandomPhrase('encourage'), 'encourage');
      } else {
        this.setMood('encouraging');
        this.showMessage(this.getUniqueRandomPhrase('motivate'), 'motivate');
      }
    }

    handleAchievement(event) {
      this.setMood('celebrating');
      this.showMessage(this.getUniqueRandomPhrase('celebrate'), 'celebrate');
      this.showParticles();
      this.startMegaDance();
    }

    handleXpGain(event) {
      const { amount } = event.detail;
      if (amount >= 50) {
        this.setMood('excited');
        this.sounds.playExcited();
        this.showMessage(this.getUniqueRandomPhrase('celebrate'), 'celebrate');
      } else {
        this.setMood('happy');
        this.showMessage(this.getUniqueRandomPhrase('encourage'), 'encourage');
      }
    }

    handleLevelUp(event) {
      this.setMood('celebrating');
      this.showMessage(this.getUniqueRandomPhrase('celebrate'), 'celebrate');
      this.showParticles();
      this.startMegaDance();
    }

    resetSleepTimer() {
      if (this.state.sleepTimer) {
        clearTimeout(this.state.sleepTimer);
      }

      // Only reset if not already sleeping
      if (this.state.mood === 'sleeping') {
        return;
      }

      // Fall asleep after 5 minutes of inactivity
      this.state.sleepTimer = setTimeout(() => {
        this.setMood('sleeping');
        this.showMessage(this.getRandomMessage('sleeping'), 'idle');
      }, 5 * 60 * 1000);
    }

    // Public method to trigger moods externally
    trigger(mood, message) {
      this.setMood(mood);
      if (message) {
        this.showMessage(message, mood);
      } else {
        this.showMessage(this.getRandomMessage(mood), mood);
      }
      if (mood === 'celebrating') {
        this.showParticles();
        this.startMegaDance();
      }
    }
  }

  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('bit-robot-container');
    if (container) {
      window.bitRobot = new BitRobot('bit-robot-container');
    }
  });
</script>

<style>
  /* Container positioning */
  .bit-container {
    z-index: 1000;
    pointer-events: auto;
  }

  .bit-container.bottom-right {
    position: fixed;
    bottom: 20px;
    right: 20px;
  }

  .bit-container.bottom-left {
    position: fixed;
    bottom: 20px;
    left: 20px;
  }

  .bit-container.inline {
    position: relative;
    display: inline-block;
  }

  @media (max-width: 768px) {
    .bit-container.bottom-right,
    .bit-container.bottom-left {
      bottom: 80px; /* Above mobile nav */
    }

    .bit-container.bottom-right {
      right: 10px;
    }

    .bit-container.bottom-left {
      left: 10px;
    }

    .bit-robot {
      transform: scale(0.85);
      transform-origin: bottom right;
    }

    .bit-container.bottom-left .bit-robot {
      transform-origin: bottom left;
    }

    .speech-bubble {
      max-width: 180px;
      min-width: 100px;
      font-size: 0.85rem;
    }
  }

  @media (max-width: 480px) {
    .bit-container.bottom-right {
      right: 8px;
    }

    .bit-container.bottom-left {
      left: 8px;
    }

    .bit-robot {
      transform: scale(0.75);
    }

    .speech-bubble {
      max-width: 150px;
      min-width: 80px;
      font-size: 0.8rem;
      padding: 8px 12px;
    }
  }

  /* Speech Bubble */
  .speech-bubble {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%) translateY(-10px);
    background: linear-gradient(180deg, #1a4a6e 0%, #0f3555 100%);
    border: 2px solid #ffd700;
    border-radius: 16px;
    padding: 10px 16px;
    min-width: 120px;
    max-width: 220px;
    text-align: center;
    opacity: 0;
    transition: opacity 0.3s ease, transform 0.3s ease;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 0 0 15px rgba(255, 215, 0, 0.2);
  }

  .speech-bubble.visible {
    opacity: 1;
    transform: translateX(-50%) translateY(-15px);
  }

  .speech-bubble[hidden] {
    display: none;
  }

  .speech-text {
    color: #f0f4f8;
    font-size: 0.85rem;
    font-weight: 600;
    line-height: 1.4;
  }

  .speech-tail {
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-top: 10px solid #ffd700;
  }

  .speech-tail::before {
    content: '';
    position: absolute;
    bottom: 2px;
    left: -8px;
    width: 0;
    height: 0;
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-top: 8px solid #0f3555;
  }

  /* Robot Base */
  .bit-robot {
    width: 80px;
    height: 120px;
    cursor: pointer;
    position: relative;
    transition: transform 0.2s ease;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
  }

  .bit-robot:hover {
    transform: scale(1.05);
  }

  .bit-robot:active {
    transform: scale(0.95);
  }

  /* Antenna */
  .antenna {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .antenna-ball {
    width: 10px;
    height: 10px;
    background: #ff4444;
    border-radius: 50%;
    box-shadow: 0 0 8px #ff4444;
    animation: antenna-pulse 2s ease-in-out infinite;
  }

  .antenna-stem {
    width: 3px;
    height: 12px;
    background: linear-gradient(180deg, #6b6b80 0%, #4a4a5a 100%);
    border-radius: 2px;
  }

  @keyframes antenna-pulse {
    0%, 100% { 
      background: #ff4444;
      box-shadow: 0 0 8px #ff4444;
    }
    50% { 
      background: #44ff44;
      box-shadow: 0 0 12px #44ff44;
    }
  }

  /* Robot Head */
  .robot-head {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 45px;
    background: linear-gradient(135deg, #5a5a6e 0%, #3d3d4d 100%);
    border: 2px solid #6b6b80;
    border-radius: 12px 12px 8px 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 
      inset 0 2px 0 rgba(255, 255, 255, 0.2),
      0 3px 0 #2d2d3d;
  }

  /* Headphones */
  .headphone {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 14px;
    height: 24px;
  }

  .headphone-left {
    left: -10px;
  }

  .headphone-right {
    right: -10px;
  }

  .headphone-cup {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #4a90d9 0%, #357abd 100%);
    border-radius: 4px;
    border: 2px solid #5a9fe3;
    box-shadow: 
      inset 0 2px 0 rgba(255, 255, 255, 0.3),
      0 2px 0 #2a5a8d;
  }

  /* Face Screen */
  .face-screen {
    width: 44px;
    height: 32px;
    background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%);
    border: 2px solid #2a2a4e;
    border-radius: 6px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: 4px;
  }

  /* Eyes */
  .eyes {
    display: flex;
    gap: 10px;
    justify-content: center;
  }

  .eye {
    width: 10px;
    height: 10px;
    background: #00ff88;
    border-radius: 50%;
    box-shadow: 0 0 8px #00ff88;
    transition: all 0.2s ease;
    position: relative;
  }

  .pupil {
    position: absolute;
    width: 4px;
    height: 4px;
    background: #0f0f1a;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  /* Mouth */
  .mouth {
    width: 16px;
    height: 3px;
    background: #00ff88;
    border-radius: 2px;
    box-shadow: 0 0 6px #00ff88;
    transition: all 0.2s ease;
  }

  /* Robot Body */
  .robot-body {
    position: absolute;
    top: 68px;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 32px;
    background: linear-gradient(135deg, #5a5a6e 0%, #3d3d4d 100%);
    border: 2px solid #6b6b80;
    border-radius: 6px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-around;
    padding: 4px;
    box-shadow: 
      inset 0 2px 0 rgba(255, 255, 255, 0.2),
      0 3px 0 #2d2d3d;
  }

  .body-screen {
    width: 20px;
    height: 14px;
    background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%);
    border: 1px solid #2a2a4e;
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .heart-icon {
    font-size: 10px;
    animation: heart-beat 1.5s ease-in-out infinite;
  }

  @keyframes heart-beat {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
  }

  .body-buttons {
    display: flex;
    gap: 4px;
  }

  .body-button {
    width: 6px;
    height: 6px;
    background: #ffd700;
    border-radius: 50%;
    box-shadow: 0 0 4px rgba(255, 215, 0, 0.5);
  }

  /* Robot Arms */
  .robot-arm {
    position: absolute;
    top: 70px;
    display: flex;
    flex-direction: column;
    align-items: center;
    transform-origin: top center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .arm-left {
    left: -20px;
  }

  .arm-right {
    right: -20px;
  }

  .arm-segment {
    width: 6px;
    height: 16px;
    background: linear-gradient(180deg, #5a5a6e 0%, #3d3d4d 100%);
    border: 1px solid #6b6b80;
    border-radius: 3px;
  }

  .arm-hand {
    font-size: 14px;
    margin-top: 2px;
  }

  /* Robot Legs */
  .robot-legs {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
  }

  .leg {
    width: 10px;
    height: 16px;
    background: linear-gradient(180deg, #5a5a6e 0%, #3d3d4d 100%);
    border: 2px solid #6b6b80;
    border-radius: 0 0 4px 4px;
    box-shadow: 0 2px 0 #2d2d3d;
  }

  /* Celebration Particles */
  .celebration-particles {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 100px;
    pointer-events: none;
  }

  .celebration-particles[hidden] {
    display: none;
  }

  .celebration-particles span {
    position: absolute;
    font-size: 16px;
    opacity: 0;
  }

  .celebration-particles.active span {
    animation: particle-burst 1.5s ease-out forwards;
  }

  .celebration-particles.active span:nth-child(1) { animation-delay: 0ms; --tx: -30px; --ty: -50px; }
  .celebration-particles.active span:nth-child(2) { animation-delay: 100ms; --tx: 30px; --ty: -40px; }
  .celebration-particles.active span:nth-child(3) { animation-delay: 200ms; --tx: -20px; --ty: -60px; }
  .celebration-particles.active span:nth-child(4) { animation-delay: 300ms; --tx: 40px; --ty: -30px; }
  .celebration-particles.active span:nth-child(5) { animation-delay: 400ms; --tx: 0px; --ty: -70px; }

  @keyframes particle-burst {
    0% {
      opacity: 1;
      transform: translate(0, 0) scale(0.5);
    }
    100% {
      opacity: 0;
      transform: translate(var(--tx), var(--ty)) scale(1.2);
    }
  }

  /* =========================== */
  /* MOOD STATES                 */
  /* =========================== */

  /* IDLE - Default subtle animation */
  .bit-robot[data-mood="idle"] {
    animation: idle-bob 3s ease-in-out infinite;
  }

  @keyframes idle-bob {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-3px); }
  }

  /* HAPPY - Curved eyes, smile */
  .bit-robot[data-mood="happy"] .eye {
    height: 6px;
    border-radius: 6px 6px 0 0;
  }

  .bit-robot[data-mood="happy"] .mouth {
    height: 6px;
    border-radius: 0 0 8px 8px;
  }

  /* EXCITED - Sparkle eyes, open mouth, bouncing */
  .bit-robot[data-mood="excited"] {
    animation: bounce 0.5s ease infinite;
  }

  .bit-robot[data-mood="excited"] .eye {
    animation: sparkle 0.5s ease infinite;
  }

  .bit-robot[data-mood="excited"] .mouth {
    width: 12px;
    height: 10px;
    border-radius: 50%;
  }

  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
  }

  @keyframes sparkle {
    0%, 100% { transform: scale(1); box-shadow: 0 0 8px #00ff88; }
    50% { transform: scale(1.3); box-shadow: 0 0 15px #00ff88, 0 0 25px #00ff88; }
  }

  /* CELEBRATING - Extra bouncing, particles shown */
  .bit-robot[data-mood="celebrating"] {
    animation: celebrate-bounce 0.4s ease infinite;
  }

  .bit-robot[data-mood="celebrating"] .eye {
    animation: sparkle 0.3s ease infinite;
  }

  .bit-robot[data-mood="celebrating"] .mouth {
    width: 18px;
    height: 12px;
    border-radius: 50%;
  }

  .bit-robot[data-mood="celebrating"] .antenna-ball {
    background: #ffd700 !important;
    box-shadow: 0 0 15px #ffd700 !important;
    animation: none;
  }

  .bit-robot[data-mood="celebrating"] .arm-left,
  .bit-robot[data-mood="celebrating"] .arm-right {
    opacity: 1;
  }

  @keyframes celebrate-bounce {
    0%, 100% { transform: translateY(0) rotate(-2deg); }
    25% { transform: translateY(-10px) rotate(2deg); }
    50% { transform: translateY(0) rotate(-2deg); }
    75% { transform: translateY(-10px) rotate(2deg); }
  }

  /* THINKING - Looking up, tilt */
  .bit-robot[data-mood="thinking"] {
    animation: think-tilt 2s ease-in-out infinite;
  }

  .bit-robot[data-mood="thinking"] .eye {
    transform: translateY(-3px);
  }

  .bit-robot[data-mood="thinking"] .pupil {
    transform: translate(-50%, -100%);
  }

  .bit-robot[data-mood="thinking"] .mouth {
    width: 8px;
    height: 6px;
    border-radius: 50%;
    margin-left: 8px;
  }

  @keyframes think-tilt {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(8deg); }
  }

  /* SLEEPING - Closed eyes, gentle bob */
  .bit-robot[data-mood="sleeping"] {
    animation: sleep-bob 2s ease-in-out infinite;
  }

  .bit-robot[data-mood="sleeping"] .eye {
    height: 3px;
    border-radius: 3px;
    animation: none;
    box-shadow: 0 0 4px #00ff88;
  }

  .bit-robot[data-mood="sleeping"] .mouth {
    width: 10px;
    height: 2px;
  }

  .bit-robot[data-mood="sleeping"] .antenna-ball {
    background: #444 !important;
    box-shadow: 0 0 4px #333 !important;
    animation: none;
  }

  .bit-robot[data-mood="sleeping"] .heart-icon {
    animation: none;
    opacity: 0.5;
  }

  @keyframes sleep-bob {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(3px); }
  }

  /* ENCOURAGING - Determined look */
  .bit-robot[data-mood="encouraging"] .eye {
    height: 8px;
    width: 12px;
    border-radius: 2px 2px 6px 6px;
  }

  .bit-robot[data-mood="encouraging"] .mouth {
    height: 4px;
    width: 14px;
    background: linear-gradient(90deg, transparent 20%, #00ff88 20%, #00ff88 80%, transparent 80%);
  }

  /* PROUD - Big happy smile */
  .bit-robot[data-mood="proud"] .eye {
    height: 5px;
    border-radius: 5px 5px 0 0;
    box-shadow: 0 0 10px #00ff88, 0 0 20px rgba(0, 255, 136, 0.5);
  }

  .bit-robot[data-mood="proud"] .mouth {
    height: 8px;
    width: 20px;
    border-radius: 0 0 10px 10px;
  }

  /* WAVE - Arm visible and waving */
  .bit-robot[data-mood="wave"] .arm-right {
    opacity: 1;
    animation: wave-arm 0.6s ease-in-out 3;
  }

  .bit-robot[data-mood="wave"] .eye {
    height: 6px;
    border-radius: 6px 6px 0 0;
  }

  .bit-robot[data-mood="wave"] .mouth {
    height: 6px;
    border-radius: 0 0 8px 8px;
  }

  @keyframes wave-arm {
    0%, 100% { transform: rotate(-10deg); }
    50% { transform: rotate(-45deg); }
  }

  /* =========================== */
  /* IDLE ACTIVITIES             */
  /* =========================== */

  /* Jumping */
  .bit-robot.activity-jumping {
    animation: robot-jump 0.5s ease-in-out infinite !important;
  }
  @keyframes robot-jump {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-15px); }
  }

  /* Learning - head nodding */
  .bit-robot.activity-learning .robot-head {
    animation: robot-nod 0.8s ease-in-out infinite;
  }
  @keyframes robot-nod {
    0%, 100% { transform: translateX(-50%) rotate(0deg); }
    30% { transform: translateX(-50%) rotate(5deg); }
    70% { transform: translateX(-50%) rotate(-5deg); }
  }

  /* Reading */
  .bit-robot.activity-reading .robot-head {
    animation: robot-read 2s ease-in-out infinite;
  }
  .bit-robot.activity-reading .eye {
    animation: robot-eye-read 2s ease-in-out infinite;
  }
  @keyframes robot-read {
    0%, 100% { transform: translateX(-50%) translateY(0) rotate(0deg); }
    50% { transform: translateX(-50%) translateY(2px) rotate(-3deg); }
  }
  @keyframes robot-eye-read {
    0%, 100% { transform: scaleY(1); }
    50% { transform: scaleY(0.7); }
  }

  /* Swimming */
  .bit-robot.activity-swimming {
    animation: robot-swim 1.5s ease-in-out infinite !important;
  }
  .bit-robot.activity-swimming .arm-left {
    opacity: 1;
    animation: robot-swim-arm-left 0.75s ease-in-out infinite;
  }
  .bit-robot.activity-swimming .arm-right {
    opacity: 1;
    animation: robot-swim-arm-right 0.75s ease-in-out infinite;
  }
  @keyframes robot-swim {
    0%, 100% { transform: translateX(-3px) rotate(-2deg); }
    50% { transform: translateX(3px) rotate(2deg); }
  }
  @keyframes robot-swim-arm-left {
    0%, 100% { transform: rotate(-20deg); }
    50% { transform: rotate(20deg); }
  }
  @keyframes robot-swim-arm-right {
    0%, 100% { transform: rotate(20deg); }
    50% { transform: rotate(-20deg); }
  }

  /* Sleeping activity */
  .bit-robot.activity-sleeping {
    animation: robot-sleep 2s ease-in-out infinite !important;
  }
  .bit-robot.activity-sleeping .eye {
    height: 2px !important;
    border-radius: 1px !important;
  }
  @keyframes robot-sleep {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
  }

  /* Dancing */
  .bit-robot.activity-dancing {
    animation: robot-dance 0.4s ease-in-out infinite !important;
  }
  .bit-robot.activity-dancing .arm-left {
    opacity: 1;
    animation: robot-dance-arm 0.4s ease-in-out infinite;
  }
  .bit-robot.activity-dancing .arm-right {
    opacity: 1;
    animation: robot-dance-arm 0.4s ease-in-out infinite reverse;
  }
  @keyframes robot-dance {
    0%, 100% { transform: translateY(0) rotate(-3deg); }
    50% { transform: translateY(-5px) rotate(3deg); }
  }
  @keyframes robot-dance-arm {
    0%, 100% { transform: rotate(-30deg); }
    50% { transform: rotate(30deg); }
  }

  /* Spinning */
  .bit-robot.activity-spinning {
    animation: robot-spin 1s ease-in-out infinite !important;
  }
  @keyframes robot-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Waving activity */
  .bit-robot.activity-waving .arm-right {
    opacity: 1;
    animation: robot-wave 0.5s ease-in-out infinite;
    transform-origin: top center;
  }
  @keyframes robot-wave {
    0%, 100% { transform: rotate(-10deg); }
    25% { transform: rotate(-45deg); }
    75% { transform: rotate(-45deg); }
  }

  /* Dizzy */
  .bit-robot.activity-dizzy {
    animation: robot-dizzy 0.3s ease-in-out infinite !important;
  }
  .bit-robot.activity-dizzy .eye {
    animation: robot-dizzy-eyes 0.5s linear infinite;
  }
  @keyframes robot-dizzy {
    0%, 100% { transform: rotate(-5deg); }
    50% { transform: rotate(5deg); }
  }
  @keyframes robot-dizzy-eyes {
    0% { transform: scale(1); }
    25% { transform: scale(0.8) rotate(90deg); }
    50% { transform: scale(1.1) rotate(180deg); }
    75% { transform: scale(0.9) rotate(270deg); }
    100% { transform: scale(1) rotate(360deg); }
  }

  /* Yoga */
  .bit-robot.activity-yoga {
    animation: robot-yoga-body 3s ease-in-out infinite !important;
  }
  .bit-robot.activity-yoga .arm-left {
    opacity: 1;
    animation: robot-yoga-arm-left 3s ease-in-out infinite;
  }
  .bit-robot.activity-yoga .arm-right {
    opacity: 1;
    animation: robot-yoga-arm-right 3s ease-in-out infinite;
  }
  @keyframes robot-yoga-body {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-3px); }
  }
  @keyframes robot-yoga-arm-left {
    0%, 100% { transform: rotate(10deg); }
    50% { transform: rotate(-80deg); }
  }
  @keyframes robot-yoga-arm-right {
    0%, 100% { transform: rotate(-10deg); }
    50% { transform: rotate(80deg); }
  }

  /* Sneeze */
  .bit-robot.activity-sneeze {
    animation: robot-sneeze 1.5s ease-in-out infinite !important;
  }
  .bit-robot.activity-sneeze .robot-head {
    animation: robot-sneeze-head 1.5s ease-in-out infinite;
  }
  @keyframes robot-sneeze {
    0%, 60% { transform: translateY(0); }
    65% { transform: translateY(-8px); }
    70% { transform: translateY(5px); }
    80%, 100% { transform: translateY(0); }
  }
  @keyframes robot-sneeze-head {
    0%, 60% { transform: translateX(-50%) rotate(0deg); }
    65% { transform: translateX(-50%) rotate(-10deg); }
    70% { transform: translateX(-50%) rotate(15deg); }
    80%, 100% { transform: translateX(-50%) rotate(0deg); }
  }

  /* Looking */
  .bit-robot.activity-looking .robot-head {
    animation: robot-look 2s ease-in-out infinite;
  }
  .bit-robot.activity-looking .pupil {
    animation: robot-look-pupil 2s ease-in-out infinite;
  }
  @keyframes robot-look {
    0%, 100% { transform: translateX(-50%) rotate(0deg); }
    25% { transform: translateX(-50%) rotate(-8deg); }
    75% { transform: translateX(-50%) rotate(8deg); }
  }
  @keyframes robot-look-pupil {
    0%, 100% { transform: translate(-50%, -50%); }
    25% { transform: translate(-100%, -50%); }
    75% { transform: translate(0%, -50%); }
  }

  /* Bored */
  .bit-robot.activity-bored .leg-right {
    animation: robot-tap-foot 0.3s ease-in-out infinite;
  }
  .bit-robot.activity-bored .robot-head {
    animation: robot-bored-head 2s ease-in-out infinite;
  }
  @keyframes robot-tap-foot {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(-15deg); }
  }
  @keyframes robot-bored-head {
    0%, 45%, 55%, 100% { transform: translateX(-50%) translateY(0); }
    50% { transform: translateX(-50%) translateY(2px); }
  }

  /* Excited activity */
  .bit-robot.activity-excited {
    animation: robot-excited 0.2s ease-in-out infinite !important;
  }
  .bit-robot.activity-excited .antenna-ball {
    animation: robot-excited-antenna 0.1s ease-in-out infinite;
  }
  @keyframes robot-excited {
    0%, 100% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-8px) scale(1.05); }
  }
  @keyframes robot-excited-antenna {
    0%, 100% { background: #ff4444; box-shadow: 0 0 6px #ff4444; }
    50% { background: #44ff44; box-shadow: 0 0 10px #44ff44; }
  }

  /* Stretching */
  .bit-robot.activity-stretching {
    animation: robot-stretch-body 2s ease-in-out infinite !important;
  }
  .bit-robot.activity-stretching .arm-left,
  .bit-robot.activity-stretching .arm-right {
    opacity: 1;
    animation: robot-stretch-arms 2s ease-in-out infinite;
  }
  @keyframes robot-stretch-body {
    0%, 100% { transform: scaleY(1); }
    50% { transform: scaleY(1.05) translateY(-3px); }
  }
  @keyframes robot-stretch-arms {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(-120deg); }
  }

  /* Headbang */
  .bit-robot.activity-headbang .robot-head {
    animation: robot-headbang 0.25s ease-in-out infinite;
  }
  @keyframes robot-headbang {
    0%, 100% { transform: translateX(-50%) rotate(0deg); }
    50% { transform: translateX(-50%) rotate(-15deg) translateY(3px); }
  }

  /* Pushups */
  .bit-robot.activity-pushups {
    animation: robot-pushup 1s ease-in-out infinite !important;
  }
  .bit-robot.activity-pushups .arm-left,
  .bit-robot.activity-pushups .arm-right {
    opacity: 1;
    animation: robot-pushup-arms 1s ease-in-out infinite;
  }
  @keyframes robot-pushup {
    0%, 100% { transform: translateY(0) rotate(-5deg); }
    50% { transform: translateY(10px) rotate(-15deg); }
  }
  @keyframes robot-pushup-arms {
    0%, 100% { transform: rotate(-30deg); }
    50% { transform: rotate(-60deg); }
  }

  /* Karate */
  .bit-robot.activity-karate {
    animation: robot-karate 0.8s ease-in-out infinite !important;
  }
  .bit-robot.activity-karate .arm-right {
    opacity: 1;
    animation: robot-karate-chop 0.8s ease-in-out infinite;
  }
  .bit-robot.activity-karate .leg-left {
    animation: robot-karate-kick 0.8s ease-in-out infinite;
  }
  @keyframes robot-karate {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(5px); }
  }
  @keyframes robot-karate-chop {
    0%, 100% { transform: rotate(-10deg); }
    50% { transform: rotate(-90deg); }
  }
  @keyframes robot-karate-kick {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(30deg); }
  }

  /* =========================== */
  /* MEGA CELEBRATION DANCE      */
  /* =========================== */

  .bit-robot.mega-dance {
    animation: mega-dance-body 4s ease-in-out infinite !important;
  }
  .bit-robot.mega-dance .robot-head {
    animation: mega-dance-head 1s ease-in-out infinite;
  }
  .bit-robot.mega-dance .arm-left {
    opacity: 1;
    animation: mega-dance-arm-left 0.5s ease-in-out infinite;
  }
  .bit-robot.mega-dance .arm-right {
    opacity: 1;
    animation: mega-dance-arm-right 0.5s ease-in-out infinite;
  }
  .bit-robot.mega-dance .leg-left {
    animation: mega-dance-leg-left 0.25s ease-in-out infinite;
  }
  .bit-robot.mega-dance .leg-right {
    animation: mega-dance-leg-right 0.25s ease-in-out infinite;
  }
  .bit-robot.mega-dance .eye {
    animation: mega-dance-eyes 0.3s ease-in-out infinite;
  }
  .bit-robot.mega-dance .antenna-ball {
    animation: mega-dance-antenna 0.15s ease-in-out infinite !important;
  }

  /* Body: jumping, spinning 360¬∞, bouncing, scaling */
  @keyframes mega-dance-body {
    0% { transform: translateY(0) rotate(0deg) scale(1); }
    5% { transform: translateY(-15px) rotate(-10deg) scale(1.1); }
    15% { transform: translateY(-20px) rotate(10deg) scale(1.15); }
    35% { transform: translateY(-25px) rotate(15deg) scale(1.2); }
    45% { transform: translateX(-10px) translateY(-5px) rotate(-5deg); }
    55% { transform: translateX(10px) translateY(-10px) rotate(8deg); }
    70% { transform: translateY(-30px) rotate(360deg) scale(1.1); }
    100% { transform: translateY(0) rotate(0deg) scale(1); }
  }

  /* Head bobbing crazy */
  @keyframes mega-dance-head {
    0%, 100% { transform: translateX(-50%) rotate(0deg); }
    20% { transform: translateX(-50%) rotate(-20deg) translateY(-3px); }
    40% { transform: translateX(-50%) rotate(20deg) translateY(2px); }
    60% { transform: translateX(-50%) rotate(-15deg) translateY(-2px); }
    80% { transform: translateX(-50%) rotate(15deg) translateY(3px); }
  }

  /* Arms going wild */
  @keyframes mega-dance-arm-left {
    0%, 100% { transform: rotate(10deg); }
    25% { transform: rotate(-120deg); }
    50% { transform: rotate(45deg); }
    75% { transform: rotate(-90deg); }
  }
  @keyframes mega-dance-arm-right {
    0%, 100% { transform: rotate(-10deg); }
    25% { transform: rotate(120deg); }
    50% { transform: rotate(-45deg); }
    75% { transform: rotate(90deg); }
  }

  /* Legs stomping */
  @keyframes mega-dance-leg-left {
    0%, 100% { transform: rotate(0deg) translateY(0); }
    50% { transform: rotate(-25deg) translateY(-5px); }
  }
  @keyframes mega-dance-leg-right {
    0%, 100% { transform: rotate(0deg) translateY(0); }
    50% { transform: rotate(25deg) translateY(-5px); }
  }

  /* Eyes flashing rainbow colors */
  @keyframes mega-dance-eyes {
    0%, 100% { transform: scale(1); background: #00ff88; box-shadow: 0 0 6px #00ff88; }
    25% { transform: scale(1.3); background: #ff00ff; box-shadow: 0 0 12px #ff00ff; }
    50% { transform: scale(0.8); background: #ffff00; box-shadow: 0 0 15px #ffff00; }
    75% { transform: scale(1.2); background: #00ffff; box-shadow: 0 0 10px #00ffff; }
  }

  /* Antenna rainbow disco */
  @keyframes mega-dance-antenna {
    0% { background: #ff0000; box-shadow: 0 0 15px #ff0000; transform: scale(1); }
    16% { background: #ff8800; box-shadow: 0 0 15px #ff8800; transform: scale(1.5); }
    33% { background: #ffff00; box-shadow: 0 0 15px #ffff00; transform: scale(1); }
    50% { background: #00ff00; box-shadow: 0 0 15px #00ff00; transform: scale(1.5); }
    66% { background: #0088ff; box-shadow: 0 0 15px #0088ff; transform: scale(1); }
    83% { background: #ff00ff; box-shadow: 0 0 15px #ff00ff; transform: scale(1.5); }
    100% { background: #ff0000; box-shadow: 0 0 15px #ff0000; transform: scale(1); }
  }

  /* Reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    .bit-robot,
    .bit-robot[data-mood="idle"],
    .bit-robot[data-mood="excited"],
    .bit-robot[data-mood="celebrating"],
    .bit-robot[data-mood="thinking"],
    .bit-robot[data-mood="sleeping"],
    .bit-robot[data-mood="wave"] .arm-right,
    .bit-robot.mega-dance,
    .antenna-ball,
    .heart-icon,
    .eye,
    .celebration-particles span {
      animation: none !important;
    }
  }
</style>
