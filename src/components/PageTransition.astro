---
/**
 * PageTransition Component
 * Smooth page transitions using View Transitions API
 */
---

<style is:global>
  /* View Transitions API styles */
  @view-transition {
    navigation: auto;
  }

  /* Default transition animations */
  ::view-transition-old(root) {
    animation: fade-out 0.2s ease-out forwards;
  }

  ::view-transition-new(root) {
    animation: fade-in 0.3s ease-out forwards;
  }

  @keyframes fade-out {
    from { opacity: 1; }
    to { opacity: 0; }
  }

  @keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  /* Slide transitions for specific elements */
  ::view-transition-old(main-content) {
    animation: slide-out-left 0.3s ease-out forwards;
  }

  ::view-transition-new(main-content) {
    animation: slide-in-right 0.3s ease-out forwards;
  }

  @keyframes slide-out-left {
    from { 
      opacity: 1;
      transform: translateX(0);
    }
    to { 
      opacity: 0;
      transform: translateX(-20px);
    }
  }

  @keyframes slide-in-right {
    from { 
      opacity: 0;
      transform: translateX(20px);
    }
    to { 
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* Fallback for browsers without View Transitions */
  .page-transition-enter {
    animation: page-enter 0.3s ease-out forwards;
  }

  .page-transition-exit {
    animation: page-exit 0.2s ease-out forwards;
  }

  @keyframes page-enter {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes page-exit {
    from {
      opacity: 1;
      transform: translateY(0);
    }
    to {
      opacity: 0;
      transform: translateY(-10px);
    }
  }

  /* Reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    ::view-transition-old(root),
    ::view-transition-new(root),
    ::view-transition-old(main-content),
    ::view-transition-new(main-content) {
      animation: none;
    }

    .page-transition-enter,
    .page-transition-exit {
      animation: none;
    }
  }
</style>

<script is:inline>
  // Fallback for browsers without View Transitions API
  (function() {
    if (!document.startViewTransition) {
      function initPageTransition() {
        // Add enter animation to main content
        const main = document.querySelector('main');
        if (main) {
          main.classList.add('page-transition-enter');
        }

        // Handle link clicks for exit animation
        document.addEventListener('click', (e) => {
          const link = e.target.closest('a');
          if (!link) return;
          
          // Don't intercept buttons or links with special classes
          if (link.classList.contains('bookmark-btn') || 
              link.classList.contains('reaction-btn') ||
              link.classList.contains('copy-link') ||
              link.tagName === 'BUTTON') {
            return;
          }
          
          const href = link.getAttribute('href');
          if (!href || 
              href.startsWith('#') || 
              href.startsWith('http') || 
              href.startsWith('mailto:') ||
              href.startsWith('javascript:')) {
            return;
          }

          // Only intercept internal links
          if (href.startsWith('/')) {
            e.preventDefault();
            e.stopPropagation();
            
            const main = document.querySelector('main');
            if (main) {
              main.classList.add('page-transition-exit');
              setTimeout(() => {
                window.location.href = href;
              }, 200);
            } else {
              window.location.href = href;
            }
          }
        });
      }
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initPageTransition);
      } else {
        initPageTransition();
      }
    }
  })();
</script>
